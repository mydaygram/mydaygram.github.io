---
import Layout from "../layouts/Layout.astro";
import Pagination from "../components/Pagination.astro";
import type { ShortPageData } from "../shared/type";
import config from "urodele.config";

interface Props {
  posts: ShortPageData[];
  page: number;
  pages: number;
}

const { posts, page, pages } = Astro.props;

// Helper function to get day of week
function getDayOfWeek(dateStr: Date): { day: string; isSunday: boolean } {
  const days = ['SUN', 'MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT'];
  const date = new Date(dateStr);
  const dayIndex = date.getDay();
  return {
    day: days[dayIndex],
    isSunday: dayIndex === 0
  };
}

// Helper function to get day number
function getDayNumber(dateStr: Date): string {
  const date = new Date(dateStr);
  return date.getDate().toString();
}

// Helper function to get month name
function getMonthName(dateStr: Date): string {
  const months = ['JAN', 'FEB', 'MAR', 'APR', 'MAY', 'JUN', 
                   'JUL', 'AUG', 'SEP', 'OCT', 'NOV', 'DEC'];
  const date = new Date(dateStr);
  return months[date.getMonth()];
}

// Helper function to get month number (1-12)
function getMonthNumber(dateStr: Date): number {
  const date = new Date(dateStr);
  return date.getMonth() + 1;
}

// Helper function to get year
function getYear(dateStr: Date): string {
  const date = new Date(dateStr);
  return date.getFullYear().toString();
}

// Current date info
const now = new Date();
const currentMonthName = ['JAN', 'FEB', 'MAR', 'APR', 'MAY', 'JUN', 
                          'JUL', 'AUG', 'SEP', 'OCT', 'NOV', 'DEC'][now.getMonth()];
const currentMonth = now.getMonth() + 1;
const currentYear = now.getFullYear();
---

<script>
  import { mount } from "../components/RelativeTime";
  mount("data-acc-time");
</script>

<Layout title={config.head.title}>
  <!-- Daygram-style brand banner -->
  <div class="brand-banner">
    {config.head.brand}
  </div>
  
  <main>
    <div class="content">
      {
        posts.map((item) => {
          const { day, isSunday } = getDayOfWeek(item.createTime);
          const dayNum = getDayNumber(item.createTime);
          return (
            <a href={`/post/${item.id}`} class="daygram-entry block no-underline">
              <div class="daygram-entry-date">
                <span class={`daygram-entry-day ${isSunday ? 'sunday' : ''}`}>{day}</span>
                <span class="daygram-entry-number">{dayNum}</span>
              </div>
              <div class="daygram-entry-content">
                <div class="daygram-entry-title">{item.title}</div>
                <div class="daygram-entry-intro">{item.intro}</div>
              </div>
            </a>
          );
        })
      }
      <Pagination page={page} pages={pages} />
    </div>
  </main>

  <!-- Simple bottom navigation bar -->
  <nav class="simple-nav">
    <!-- Month link: shows posts from that month -->
    <a href={`/month/${posts.length > 0 ? getMonthNumber(posts[0].createTime) : currentMonth}`} class="simple-nav-item">
      {posts.length > 0 ? getMonthName(posts[0].createTime) : currentMonthName}
    </a>
    <span class="simple-nav-sep">|</span>
    <!-- Year link: shows posts from that year -->
    <a href={`/year/${posts.length > 0 ? getYear(posts[0].createTime) : currentYear}`} class="simple-nav-item">
      {posts.length > 0 ? getYear(posts[0].createTime) : currentYear}
    </a>
    <!-- Add new entry link -->
    <a href="/edit?new" class="simple-nav-plus">+</a>
    <!-- Tags link -->
    <a href="/tag" class="simple-nav-item">Tags</a>
  </nav>
</Layout>

<style>
  .simple-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    height: 50px;
    background-color: #F2F1ED;
    border-top: 1px solid #504F4B;
    display: flex;
    align-items: center;
    justify-content: space-around;
    padding: 0 20px;
    z-index: 100;
  }

  @media (prefers-color-scheme: dark) {
    .simple-nav {
      background-color: #2A2927;
      border-top-color: #504F4B;
    }
  }

  .simple-nav-item {
    color: #504F4B;
    text-decoration: none;
    font-size: 14px;
    font-weight: bold;
    padding: 10px 15px;
  }

  .simple-nav-item:hover {
    opacity: 0.7;
  }

  @media (prefers-color-scheme: dark) {
    .simple-nav-item {
      color: #E8E6E1;
    }
  }

  .simple-nav-sep {
    color: #504F4B;
    font-size: 14px;
  }

  @media (prefers-color-scheme: dark) {
    .simple-nav-sep {
      color: #504F4B;
    }
  }

  .simple-nav-plus {
    width: 40px;
    height: 40px;
    background-color: #504F4B;
    color: #F2F1ED;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    text-decoration: none;
    font-size: 24px;
    font-weight: bold;
  }

  .simple-nav-plus:hover {
    opacity: 0.8;
  }
 
  @media (prefers-color-scheme: dark) {
    .simple-nav-plus {
      background-color: #E8E6E1;
      color: #2A2927;
    }
  }
</style>
