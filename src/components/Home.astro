---
import Layout from "../layouts/Layout.astro";
import Pagination from "../components/Pagination.astro";
import type { ShortPageData } from "../shared/type";
import config from "urodele.config";

interface Props {
  posts: ShortPageData[];
  page: number;
  pages: number;
}

const { posts, page, pages } = Astro.props;

// Helper function to get day of week
function getDayOfWeek(dateStr: Date): { day: string; isSunday: boolean } {
  const days = ['SUN', 'MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT'];
  const date = new Date(dateStr);
  const dayIndex = date.getDay();
  return {
    day: days[dayIndex],
    isSunday: dayIndex === 0
  };
}

// Helper function to get day number
function getDayNumber(dateStr: Date): string {
  const date = new Date(dateStr);
  return date.getDate().toString();
}

// Current date (always show current month/year)
const now = new Date();
const currentMonth = now.getMonth() + 1;
const currentYear = now.getFullYear();
const monthNames = ['JAN', 'FEB', 'MAR', 'APR', 'MAY', 'JUN', 
                   'JUL', 'AUG', 'SEP', 'OCT', 'NOV', 'DEC'];
const currentMonthName = monthNames[now.getMonth()];
---

<script>
  import { mount } from "../components/RelativeTime";
  mount("data-acc-time");
</script>

<Layout title={config.head.title}>
  <!-- Daygram-style brand banner -->
  <div class="brand-banner">
    {config.head.brand}
  </div>
  
  <main>
    <div class="content">
      {
        posts.map((item) => {
          const { day, isSunday } = getDayOfWeek(item.createTime);
          const dayNum = getDayNumber(item.createTime);
          return (
            <a href={`/post/${item.id}`} class="daygram-entry block no-underline">
              <div class="daygram-entry-date">
                <span class={`daygram-entry-day ${isSunday ? 'sunday' : ''}`}>{day}</span>
                <span class="daygram-entry-number">{dayNum}</span>
              </div>
              <div class="daygram-entry-content">
                <div class="daygram-entry-title">{item.title}</div>
                <div class="daygram-entry-intro">{item.intro}</div>
              </div>
            </a>
          );
        })
      }
      <Pagination page={page} pages={pages} />
    </div>
  </main>

  <!-- Bottom navigation bar -->
  <nav class="bottom-nav">
    <a href={`/month/${currentMonth}`} class="nav-item">
      <span class="nav-label">{currentMonthName}</span>
    </a>
    
    <a href={`/year/${currentYear}`} class="nav-item">
      <span class="nav-label">{currentYear}</span>
    </a>
    
    <a href="/edit?new" class="nav-plus" aria-label="Add new entry">
      <span class="plus-icon">+</span>
    </a>
    
    <a href="/tag" class="nav-item">
      <span class="nav-label">Tags</span>
    </a>
  </nav>
</Layout>

<style>
  .bottom-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    height: 56px;
    background-color: #F2F1ED;
    border-top: 1px solid #504F4B;
    display: flex;
    align-items: center;
    justify-content: space-evenly;
    padding: 0;
    z-index: 100;
  }

  @media (prefers-color-scheme: dark) {
    .bottom-nav {
      background-color: #2A2927;
      border-top-color: #504F4B;
    }
  }

  .nav-item {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100%;
    text-decoration: none;
    color: #504F4B;
    transition: background-color 0.2s ease;
  }

  .nav-item:hover {
    background-color: rgba(80, 79, 75, 0.08);
  }

  .nav-item:active {
    background-color: rgba(80, 79, 75, 0.15);
  }

  @media (prefers-color-scheme: dark) {
    .nav-item {
      color: #E8E6E1;
    }
    .nav-item:hover {
      background-color: rgba(232, 230, 225, 0.08);
    }
    .nav-item:active {
      background-color: rgba(232, 230, 225, 0.15);
    }
  }

  .nav-label {
    font-size: 14px;
    font-weight: 600;
    letter-spacing: 0.5px;
  }

  .nav-plus {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100%;
    text-decoration: none;
    transition: background-color 0.2s ease;
  }

  .nav-plus:hover {
    background-color: rgba(80, 79, 75, 0.08);
  }

  .nav-plus:active {
    background-color: rgba(80, 79, 75, 0.15);
  }

  @media (prefers-color-scheme: dark) {
    .nav-plus:hover {
      background-color: rgba(232, 230, 225, 0.08);
    }
    .nav-plus:active {
      background-color: rgba(232, 230, 225, 0.15);
    }
  }

  .plus-icon {
    width: 36px;
    height: 36px;
    background-color: #504F4B;
    color: #F2F1ED;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    font-weight: 300;
    line-height: 1;
  }

  @media (prefers-color-scheme: dark) {
    .plus-icon {
      background-color: #E8E6E1;
      color: #2A2927;
    }
  }
</style>
