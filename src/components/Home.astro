---
import Layout from "../layouts/Layout.astro";
import Pagination from "../components/Pagination.astro";
import type { ShortPageData } from "../shared/type";
import config from "urodele.config";

interface Props {
  posts: ShortPageData[];
  page: number;
  pages: number;
}

const { posts, page, pages } = Astro.props;

// Helper function to get day of week
function getDayOfWeek(dateStr: Date): { day: string; isSunday: boolean } {
  const days = ['SUN', 'MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT'];
  const date = new Date(dateStr);
  const dayIndex = date.getDay();
  return {
    day: days[dayIndex],
    isSunday: dayIndex === 0
  };
}

// Helper function to get day number
function getDayNumber(dateStr: Date): string {
  const date = new Date(dateStr);
  return date.getDate().toString();
}

// Helper function to get month name
function getMonthName(dateStr: Date): string {
  const months = ['JANUARY', 'FEBRUARY', 'MARCH', 'APRIL', 'MAY', 'JUNE', 
                   'JULY', 'AUGUST', 'SEPTEMBER', 'OCTOBER', 'NOVEMBER', 'DECEMBER'];
  const date = new Date(dateStr);
  return months[date.getMonth()];
}

// Helper function to get year
function getYear(dateStr: Date): string {
  const date = new Date(dateStr);
  return date.getFullYear().toString();
}
---

<script>
  import { mount } from "../components/RelativeTime";
  mount("data-acc-time");
</script>

<Layout title={config.head.title}>
  <!-- Daygram-style brand banner -->
  <div class="brand-banner">
    {config.head.brand}
  </div>
  
  <main>
    <div class="content">
      {
        posts.map((item) => {
          const { day, isSunday } = getDayOfWeek(item.createTime);
          const dayNum = getDayNumber(item.createTime);
          return (
            <a href={`/post/${item.id}`} class="daygram-entry block no-underline">
              <div class="daygram-entry-date">
                <span class={`daygram-entry-day ${isSunday ? 'sunday' : ''}`}>{day}</span>
                <span class="daygram-entry-number">{dayNum}</span>
              </div>
              <div class="daygram-entry-content">
                <div class="daygram-entry-title">{item.title}</div>
                <div class="daygram-entry-intro">{item.intro}</div>
              </div>
            </a>
          );
        })
      }
      <Pagination page={page} pages={pages} />
    </div>
  </main>

  <!-- Daygram-style bottom navigation -->
  <nav class="daygram-nav">
    <div class="daygram-nav-left">
      <div class="daygram-nav-indicator"></div>
      <span class="daygram-nav-month">
        {posts.length > 0 ? getMonthName(posts[0].createTime) : 'JANUARY'}
      </span>
      <div class="daygram-nav-separator"></div>
      <span class="daygram-nav-year">
        {posts.length > 0 ? getYear(posts[0].createTime) : new Date().getFullYear().toString()}
      </span>
    </div>
    <div class="daygram-nav-center">
      <a href="/edit" class="daygram-nav-plus" aria-label="Add new entry"></a>
    </div>
    <div class="daygram-nav-right">
      <a href="/tag" class="daygram-nav-icon" aria-label="Tags"></a>
    </div>
  </nav>
</Layout>
